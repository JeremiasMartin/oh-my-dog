{% load static %}
<div class="search-container">
    <form method="GET" action="" id='turno-buscar'>
        <select name='filtro' id='filtro-turnos'>
            {% if request.path != '/turnos/listar_confirmados_dia/'%}
                <option id='fecha' value='fecha'>Fecha</option>
            {% endif %}
            <option id='atencion' value='atencion'>Atención</option>
            <option id= 'cliente_dni' value='cliente_dni'>DNI</option>
            <option id= 'cliente_nombre_apellido' value='cliente_nombre_apellido'>Nombre Apellido</option>
        </select>
        <input type="text" class="search-input" id='consulta-input' name="consulta" placeholder="Buscar...">
        <button type="submit" id="btn-buscar" class="search-button">Buscar</button>
    </form>
</div>

<script>
  var filtroSelect = document.getElementById('filtro-turnos');
  var consultaInput = document.getElementById('consulta-input');
  var btnBuscar = document.getElementById('btn-buscar');
  var errorText = '';

  filtroSelect.addEventListener('change', validarFiltro);
  consultaInput.addEventListener('input', validarConsulta);

  consultaInput.addEventListener('mouseenter', function() {
    if (btnBuscar.disabled) {
      consultaInput.title = errorText;
    }
  });

  consultaInput.addEventListener('mouseleave', function() {
    consultaInput.title = '';
  });

  function validarBusqueda() {
    var isFormValid = true;

    if (filtroSelect.value === 'fecha') {
      var formato_fecha = /^(0?[1-9]|[12][0-9]|3[01])\/(0?[1-9]|1[0-2])\/\d{4}$/;
      if (!formato_fecha.test(consultaInput.value)) {
        errorText = 'Por favor, ingrese una fecha en el formato dd/mm/yyyy.';
        isFormValid = false;
      }
    }

    if (filtroSelect.value === 'cliente_dni') {
      var dni = consultaInput.value;
      if (dni.length < 7) {
        errorText = 'Por favor, ingrese un DNI con al menos 7 dígitos.';
        isFormValid = false;
      }
      var numeros = /^[0-9]+$/;
      if (!dni.match(numeros)) {
        errorText = 'Por favor, ingrese un DNI con al menos 7 dígitos.';
        isFormValid = false;
      }
    }

    if (filtroSelect.value === 'atencion' || filtroSelect.value === 'cliente_nombre_apellido') {
      var regex = /^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$/;
      if (!regex.test(consultaInput.value)) {
        errorText = 'Por favor, ingrese solo letras (incluyendo acentos) en el campo de consulta.';
        isFormValid = false;
      }
    }

    btnBuscar.disabled = !isFormValid;
  }

  function validarFiltro() {
    validarBusqueda();
  }

  function validarConsulta() {
    validarBusqueda();
  }
</script>
